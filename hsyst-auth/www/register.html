<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistema de Registro - Hsyst Auth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#4caf50",
              secondary: "#388e3c",
              dark: "#1a1a1a",
              "dark-light": "#2b2b2b",
            },
            animation: {
              "fade-up": "fadeUp 0.5s ease-out",
              "pulse-slow": "pulse 3s infinite",
              "bounce-slow": "bounce 3s infinite",
              float: "float 6s ease-in-out infinite",
              glow: "glow 2s ease-in-out infinite",
            },
            keyframes: {
              fadeUp: {
                "0%": { opacity: "0", transform: "translateY(20px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
              float: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-10px)" },
              },
              glow: {
                "0%, 100%": { boxShadow: "0 0 15px rgba(76, 175, 80, 0.3)" },
                "50%": { boxShadow: "0 0 30px rgba(76, 175, 80, 0.6)" },
              },
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Poppins", sans-serif;
      }
    </style>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  </head>

  <body class="bg-gradient-to-br from-dark-light to-dark min-h-screen">
    <!-- Background decoration -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div
        class="absolute -top-32 -right-32 w-64 h-64 bg-primary/10 rounded-full blur-3xl animate-float"
      ></div>
      <div
        class="absolute -bottom-32 -left-32 w-64 h-64 bg-secondary/10 rounded-full blur-3xl animate-float"
        style="animation-delay: -3s"
      ></div>
    </div>

    <div
      class="min-h-screen flex items-center justify-center p-4 backdrop-blur-sm relative"
    >
      <div
        class="w-full max-w-md p-8 bg-dark-light/95 rounded-2xl shadow-2xl space-y-8 animate-fade-up backdrop-blur-md border border-primary/20 animate-glow"
      >
        <div
          class="text-center transform hover:scale-105 transition-transform duration-300"
        >
          <h2
            class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary animate-pulse-slow"
          >
            Hsyst Auth
          </h2>
          <p class="text-gray-400 mt-3 text-sm tracking-wider">
            Crie sua conta para continuar
          </p>
        </div>

        <form id="register-form" class="space-y-6">
          <div class="group space-y-2">
            <label
              for="email"
              class="block text-sm font-medium text-gray-300 transition-all group-hover:text-primary"
            >
              E-mail
            </label>
            <div class="relative">
              <input
                type="email"
                id="email"
                name="email"
                class="w-full px-6 py-4 bg-dark/50 border-2 border-primary/30 rounded-xl text-white focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all duration-300 hover:border-primary/60 placeholder:text-gray-500"
                placeholder="Digite seu e-mail"
                required
              />
              <span
                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-xl opacity-0 transition-all duration-300 group-hover:opacity-100 group-hover:-translate-x-2"
              >
                ‚úâÔ∏è
              </span>
            </div>
          </div>

          <div class="group space-y-2">
            <label
              for="password"
              class="block text-sm font-medium text-gray-300 transition-all group-hover:text-primary"
            >
              Senha
            </label>
            <div class="flex flex-row gap-4">
            <div class="relative">
              <input
                type="password"
                id="password"
                name="password"
                class="w-full px-6 py-4 bg-dark/50 border-2 border-primary/30 rounded-xl text-white focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all duration-300 hover:border-primary/60 placeholder:text-gray-500"
                placeholder="Digite sua senha"
                required
              />
              <span
                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-xl opacity-0 transition-all duration-300 group-hover:opacity-100 group-hover:-translate-x-2"
              >
                üîí
              </span>
              </div>
              <button type="button" onclick="var input = document.getElementById('password'); var icon = document.getElementById('eyeIcon'); if (input.type === 'password') { input.type = 'text'; icon.innerHTML = '<i class=\'bx bxs-show\'></i>'; } else { input.type = 'password'; icon.innerHTML = '<i class=\'bx bxs-low-vision\'></i>'; }" class="w-1/4 py-4 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-xl transition-all duration-500 hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-primary/50 relative overflow-hidden group">
                <span id="eyeIcon">
                  <i class='bx bxs-low-vision max-w-full'></i> 
                </span>
                <div
              class="absolute inset-0 bg-white/20 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500"
              ></div>
              </button>
            </div>
          </div>

          <button
            type="submit"
            class="w-full py-4 bg-gradient-to-r from-primary to-secondary text-white text-lg font-semibold rounded-xl transition-all duration-500 hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-primary/50 relative overflow-hidden group"
          >
            <span class="relative z-10 flex items-center justify-center gap-2">
              Registrar <span class="text-xl">‚Üí</span>
            </span>
            <div
              class="absolute inset-0 bg-white/20 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500"
            ></div>
          </button>

          <div
            id="error-message"
            class="text-red-500 text-center text-sm animate-bounce-slow"
          ></div>
        </form>

        <!-- Additional Buttons -->
        <div class="flex justify-between mt-4">
          <a
            href="/login.html"
            class="text-sm text-primary hover:text-secondary transition-all duration-300"
          >
            Login
          </a>
        </div>
      </div>
    </div>

    <script>
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
      }

      function deleteCookie(name) {
        document.cookie = `${name}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC; secure; samesite=strict`;
      }

      (async function () {
        const tokenAES = getCookie("tokenAES");

        if (tokenAES) {
          try {
            const response = await fetch(
              `/login?tokenReg=${encodeURIComponent(tokenAES)}`
            );
            const data = await response.json();

            if (data.status === "Success") {
              alert(
                "N√≥s identificamos que voc√™ j√° tem uma conta. (Confirme para continuar)"
              );
              alert(
                "Ao continuar, voc√™ ter√° sua sess√£o encerrada na Hsyst Auth. (Confirme para continuar)"
              );
              window.location.href = "/logout.html";
            }
          } catch (error) {
            console.error("Erro ao verificar login:", error);
          }
        }
      })();

      document
        .getElementById("register-form")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const errorMessage = document.getElementById("error-message");
          errorMessage.textContent = "";

          // Fun√ß√£o para verificar a autoriza√ß√£o no backend
          async function checkAuthorization() {
            try {
              const response = await fetch(
                "https://captcha.hsyst.xyz/check_authorization",
                {
                  method: "GET",
                  credentials: "include", // Inclui cookies na requisi√ß√£o
                }
              );
              const { authorized } = await response.json();
              return authorized;
            } catch (error) {
              console.error("Erro ao verificar autoriza√ß√£o:", error);
              return false;
            }
          }

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          try {
            // Passo 1: Gerar o token JWT (crypt1)
            const crypt1Response = await fetch(
              `/crypt1?email=${encodeURIComponent(email)}&senha=${encodeURIComponent(
                password
              )}`
            );
            const crypt1Data = await crypt1Response.json();

            if (!crypt1Data.jwtToken) {
              throw new Error("Erro ao adquirir o token JWT do crypt1.");
            }

            // Passo 2: Gerar o token AES (crypt2)
            const crypt2Response = await fetch(
              `/crypt2?email=${encodeURIComponent(email)}&senha=${encodeURIComponent(
                password
              )}&crypt1=${encodeURIComponent(crypt1Data.jwtToken)}`
            );
            const crypt2Data = await crypt2Response.json();

            if (!crypt2Data.tokenAES) {
              throw new Error("Erro ao adquirir o token AES do crypt2.");
            }

            // Passo 3: Registrar o usu√°rio e enviar e-mail de verifica√ß√£o
            const registerResponse = await fetch(
              `/register?tokenReg=${encodeURIComponent(crypt2Data.tokenAES)}`
            );
            const registerData = await registerResponse.json();

            if (registerData.status === "Error") {
              errorMessage.textContent = registerData.log;
            } else {
              window.location.href = "/login.html"; // Redireciona para a p√°gina de login ap√≥s o registro
            }
          } catch (error) {
            console.error("Erro durante o registro:", error);
            errorMessage.textContent =
              "Ocorreu um erro durante o registro. Tente novamente mais tarde.";
          }
        });
    </script>
  </body>
</html>
